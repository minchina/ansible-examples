---
- name: 停止服务
  command: service "{{ jar_name }}" stop

- name: 等待服务停止
  wait_for:
    host: 0.0.0.0
    port: "{{ server_port }}"
    delay: 10
    state: drained

- name: 删除符号链接
  file:
    path: "/etc/init.d/{{ jar_name }}"
    state: absent

- name: 删除上一次build的Jar包
  file:
    state: absent
    path: "{{ path }}{{ jar_name }}"

- name: 下载最新的JAR包
  get_url:
     url: "{{ jar_url }}"
     dest: "{{ path }}"
     mode: 0755

- name: 重新创建新的连接
  file:
    src: "{{ path }}{{ jar_name }}"
    dest: "/etc/init.d/{{ jar_name }}"
    owner: root
    group: root
    state: link
- name: 重新启动服务
  command: service "{{ jar_name }}" start

- name: 等待服务重新启动
  wait_for: port="{{ server_port }}"

